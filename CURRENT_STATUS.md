# Текущий статус - Arcpit

## Что было исправлено только что

### 1. Проблема с получением героя для способностей ✅
**Проблема:** Герой создавался, но при попытке добавить способности он не находился  
**Решение:** 
- Добавлен Map для хранения ссылок на героев игроков
- Теперь герой сохраняется сразу после создания
- Используется сохраненная ссылка вместо `PlayerResource.GetSelectedHeroEntity()`

### 2. Добавлен отладочный UI элемент ✅
**Что сделано:**
- Добавлена красная надпись "ARCPIT HUD LOADED!" в левом верхнем углу экрана
- Это позволит проверить загружается ли кастомный UI вообще

## Что должно произойти при запуске

### Сценарий игры:
1. **Автоматический пропуск стандартного выбора** (может мельком показаться экран)
2. **Стадия 1 - Выбор героя (5 сек)**
   - На сервере: создается случайный герой
   - На клиенте: ДОЛЖЕН показаться затемненный экран с надписью "ВЫБОР ГЕРОЯ" и таймер "5, 4, 3, 2, 1"
3. **Стадия 2 - Выбор способностей (5 сек)**
   - На сервере: удаляются все способности героя, добавляются 5 случайных
   - На клиенте: ДОЛЖЕН показаться затемненный экран с надписью "ВЫБОР СПОСОБНОСТЕЙ" и таймер
4. **Стадия 3 - Подготовка (10 сек)**
   - Герой телепортируется в центр карты
   - Все игроки становятся союзниками (команда GOODGUYS)
   - На клиенте: ДОЛЖЕН показаться экран "ПОДГОТОВКА К БОЮ"
5. **Боевая стадия**
   - Все возвращаются в свои команды - становятся врагами
   - На клиенте: кратко показывается "БОЙ НАЧАЛСЯ!"

## Что нужно проверить

### 1. Загружается ли UI?
**Ищите в игре в левом верхнем углу текст "ARCPIT HUD LOADED!"**
- ✅ Если текст есть - UI загрузился, проблема в событиях
- ❌ Если текста нет - UI не загрузился, проблема с custom_ui_manifest.xml

### 2. Логи сервера (консоль)
Должны быть такие сообщения:
```
[VScript]: === Starting hero selection phase ===
[VScript]: Sending stage_changed event: stage=1, duration=5
[VScript]: === Auto-selecting heroes for all players ===
[VScript]: Creating hero npc_dota_hero_XXX for player 0 on team 2
[VScript]: ✓ Hero created successfully for player 0, saved to map
[VScript]: === Starting ability selection phase ===
[VScript]: Sending stage_changed event: stage=2, duration=5
[VScript]: === Auto-selecting abilities for all players ===
[VScript]: Processing abilities for player 0, hero: npc_dota_hero_XXX
[VScript]:   Selected abilities: ability1, ability2, ability3, ability4, ability5
[VScript]:   ✓ Added ability: ability1
...
```

### 3. Логи клиента (Panorama)
Должны быть (если UI загрузился):
```
[PanoramaScript]: === Arcpit HUD script START ===
[PanoramaScript]: === Checking panels ===
[PanoramaScript]: ✓ StagePanel found
[PanoramaScript]: === STAGE_CHANGED EVENT RECEIVED ===
[PanoramaScript]: Stage: 1, Duration: 5
```

## Команды для тестирования

### Запустить игру:
```bash
bun run launch
```

### Посмотреть логи:
```bash
bun run logs
```

### В игре через консоль (~):
```
dota_hero_god_mode 1        # Бессмертие
dota_dev hero_level 25      # 25 уровень
script_reload               # Перезагрузить скрипты
```

## Возможные проблемы и решения

### Проблема: "ARCPIT HUD LOADED!" не видно
**Причина:** custom_ui_manifest.xml не загрузился  
**Решение:** Проверьте логи на ошибки компиляции XML

### Проблема: Текст виден, но экраны стадий не показываются
**Причина:** События не доходят до клиента  
**Решение:** Проверьте логи Panorama на наличие сообщений о получении событий

### Проблема: У героя нет способностей
**Причина:** Ошибка при добавлении способностей  
**Решение:** Проверьте логи на сообщения типа "✗ Failed to add ability"

### Проблема: Герой не телепортируется в центр
**Причина:** Не найдена точка спавна info_player_start_dota  
**Решение:** Проверьте наличие этой точки на карте или измените код чтобы использовать координаты (0, 0, 128)

## Следующие шаги

Если все работает:
1. Добавить UI для отображения списка способностей
2. Добавить возможность выбора из 3 героев
3. Добавить систему раундов
4. Добавить подсчет очков

Если не работает:
1. Сообщите какая именно проблема
2. Приложите часть логов с ошибкой
3. Скажите видна ли надпись "ARCPIT HUD LOADED!"

