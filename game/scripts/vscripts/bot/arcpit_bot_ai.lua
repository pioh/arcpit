local ____lualib = require("lualib_bundle")
local __TS__StringStartsWith = ____lualib.__TS__StringStartsWith
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["6"] = 6,["7"] = 6,["8"] = 7,["9"] = 7,["10"] = 20,["11"] = 22,["12"] = 23,["15"] = 25,["16"] = 26,["17"] = 27,["18"] = 28,["21"] = 24,["24"] = 30,["25"] = 23,["26"] = 34,["27"] = 35,["28"] = 36,["29"] = 38,["30"] = 38,["31"] = 38,["32"] = 38,["33"] = 38,["34"] = 38,["35"] = 38,["36"] = 38,["37"] = 38,["38"] = 38,["39"] = 38,["40"] = 38,["41"] = 51,["42"] = 51,["43"] = 51,["44"] = 51,["45"] = 51,["46"] = 51,["47"] = 51,["48"] = 51,["49"] = 51,["50"] = 51,["51"] = 51,["52"] = 51,["53"] = 51,["54"] = 51,["55"] = 51,["56"] = 67,["57"] = 67,["58"] = 67,["59"] = 67,["60"] = 67,["61"] = 67,["62"] = 67,["63"] = 67,["64"] = 67,["65"] = 67,["66"] = 67,["67"] = 67,["68"] = 67,["69"] = 81,["72"] = 84,["73"] = 85,["74"] = 85,["78"] = 83,["81"] = 87,["82"] = 81,["83"] = 90,["84"] = 91,["86"] = 92,["87"] = 92,["88"] = 93,["89"] = 94,["90"] = 94,["92"] = 92,["95"] = 96,["96"] = 90,["97"] = 99,["99"] = 100,["100"] = 100,["102"] = 101,["103"] = 102,["104"] = 102,["108"] = 104,["109"] = 104,["113"] = 103,["118"] = 100,["121"] = 107,["122"] = 99,["123"] = 110,["124"] = 111,["126"] = 112,["127"] = 112,["129"] = 113,["130"] = 114,["131"] = 114,["133"] = 115,["134"] = 116,["135"] = 116,["137"] = 118,["138"] = 118,["140"] = 119,["141"] = 119,["143"] = 120,["146"] = 121,["149"] = 121,["155"] = 122,["156"] = 122,["160"] = 112,["163"] = 124,["164"] = 110,["165"] = 127,["166"] = 128,["167"] = 128,["168"] = 128,["169"] = 128,["170"] = 128,["171"] = 127,["172"] = 135,["173"] = 136,["174"] = 136,["175"] = 136,["176"] = 136,["177"] = 136,["178"] = 135,["179"] = 143,["180"] = 145,["183"] = 147,["184"] = 148,["185"] = 151,["186"] = 152,["187"] = 153,["188"] = 154,["192"] = 160,["193"] = 161,["195"] = 163,["196"] = 163,["198"] = 164,["199"] = 165,["200"] = 165,["202"] = 166,["203"] = 166,["205"] = 167,["208"] = 168,["211"] = 168,["217"] = 169,["218"] = 169,["220"] = 170,["224"] = 163,["228"] = 143,["229"] = 176,["230"] = 177,["231"] = 178,["232"] = 179,["233"] = 180,["234"] = 180,["235"] = 180,["236"] = 180,["237"] = 180,["238"] = 180,["239"] = 180,["240"] = 180,["241"] = 180,["242"] = 180,["243"] = 180,["244"] = 191,["245"] = 191,["247"] = 192,["248"] = 176,["249"] = 195,["250"] = 196,["252"] = 198,["253"] = 198,["255"] = 199,["256"] = 200,["257"] = 200,["259"] = 201,["260"] = 201,["262"] = 202,["263"] = 202,["265"] = 204,["266"] = 205,["267"] = 205,["269"] = 208,["270"] = 209,["271"] = 209,["272"] = 209,["273"] = 209,["274"] = 209,["275"] = 214,["277"] = 218,["278"] = 219,["279"] = 219,["280"] = 219,["281"] = 219,["282"] = 219,["283"] = 219,["284"] = 225,["286"] = 229,["287"] = 230,["288"] = 231,["289"] = 231,["290"] = 231,["291"] = 234,["292"] = 234,["293"] = 234,["294"] = 234,["295"] = 231,["296"] = 231,["297"] = 231,["298"] = 237,["302"] = 198,["305"] = 241,["306"] = 195,["307"] = 244,["308"] = 246,["309"] = 246,["311"] = 247,["312"] = 247,["314"] = 249,["316"] = 251,["317"] = 251,["319"] = 252,["320"] = 253,["321"] = 253,["323"] = 254,["324"] = 254,["326"] = 255,["327"] = 255,["329"] = 256,["330"] = 256,["332"] = 257,["333"] = 257,["335"] = 259,["336"] = 260,["337"] = 260,["339"] = 263,["340"] = 264,["341"] = 264,["342"] = 264,["343"] = 264,["344"] = 264,["345"] = 269,["347"] = 273,["348"] = 274,["349"] = 274,["350"] = 274,["351"] = 274,["352"] = 274,["353"] = 274,["354"] = 280,["356"] = 284,["357"] = 285,["358"] = 286,["359"] = 286,["360"] = 286,["361"] = 289,["362"] = 289,["363"] = 289,["364"] = 289,["365"] = 286,["366"] = 286,["367"] = 286,["368"] = 292,["372"] = 251,["375"] = 296,["376"] = 244,["377"] = 299,["378"] = 300,["379"] = 300,["381"] = 301,["382"] = 301,["384"] = 304,["385"] = 305,["386"] = 307,["387"] = 308,["388"] = 309,["389"] = 310,["390"] = 311,["392"] = 313,["393"] = 314,["394"] = 315,["395"] = 315,["398"] = 317,["399"] = 318,["400"] = 319,["401"] = 319,["404"] = 321,["406"] = 324,["407"] = 327,["408"] = 327,["409"] = 330,["410"] = 331,["411"] = 332,["412"] = 327,["413"] = 327,["414"] = 327,["415"] = 327,["416"] = 327,["417"] = 327,["418"] = 327,["419"] = 327,["420"] = 327,["421"] = 343,["422"] = 344,["424"] = 347,["425"] = 347,["427"] = 348,["428"] = 349,["429"] = 349,["431"] = 350,["432"] = 350,["434"] = 351,["435"] = 351,["437"] = 352,["438"] = 352,["440"] = 353,["441"] = 353,["443"] = 355,["444"] = 356,["445"] = 356,["447"] = 358,["448"] = 359,["449"] = 359,["450"] = 359,["451"] = 359,["452"] = 359,["453"] = 364,["455"] = 368,["456"] = 369,["457"] = 369,["458"] = 369,["459"] = 369,["460"] = 369,["461"] = 369,["462"] = 375,["464"] = 379,["465"] = 380,["466"] = 381,["467"] = 381,["468"] = 381,["469"] = 381,["470"] = 381,["471"] = 381,["472"] = 387,["476"] = 347,["479"] = 392,["480"] = 393,["481"] = 393,["484"] = 396,["485"] = 396,["486"] = 396,["487"] = 396,["488"] = 396,["489"] = 401,["491"] = 404,["492"] = 299,["493"] = 408,["494"] = 409});
local ____exports = {}
local ____game_2Dconstants = require("config.game-constants")
local GAME_CONSTANTS = ____game_2Dconstants.GAME_CONSTANTS
local ____arena_2Dlayout = require("shared.arena-layout")
local buildLayout = ____arena_2Dlayout.buildLayout
local layout = buildLayout(nil, {debug = false, logPrefix = "[arena-layout]"})
local neutralBounds = layout.neutral.extendedBounds
local function isInNeutral(____, unit)
    do
        local ____try, ____hasReturned, ____returnValue = pcall(function()
            local o = unit:GetAbsOrigin()
            local x = o.x
            local y = o.y
            return true, x >= neutralBounds.mins.x and x <= neutralBounds.maxs.x and y >= neutralBounds.mins.y and y <= neutralBounds.maxs.y
        end)
        if ____try and ____hasReturned then
            return ____returnValue
        end
    end
    return false
end
local nextShopThinkAt = 0
local nextUseItemAt = 0
local nextFunCastAt = 0
local CHEAP_ITEMS = {
    "item_branches",
    "item_magic_stick",
    "item_magic_wand",
    "item_boots",
    "item_wind_lace",
    "item_ring_of_health",
    "item_void_stone",
    "item_energy_booster",
    "item_cloak",
    "item_blight_stone"
}
local MID_ITEMS = {
    "item_power_treads",
    "item_phase_boots",
    "item_arcane_boots",
    "item_blink",
    "item_force_staff",
    "item_glimmer_cape",
    "item_euls",
    "item_rod_of_atos",
    "item_urn_of_shadows",
    "item_spirit_vessel",
    "item_echo_sabre",
    "item_desolator",
    "item_maelstrom"
}
local LATE_ITEMS = {
    "item_black_king_bar",
    "item_assault",
    "item_shivas_guard",
    "item_heart",
    "item_octarine_core",
    "item_sheepstick",
    "item_bloodthorn",
    "item_mjollnir",
    "item_butterfly",
    "item_satanic",
    "item_abyssal_blade"
}
local function now(self)
    do
        local ____try, ____hasReturned, ____returnValue = pcall(function()
            local t = GameRules:GetGameTime()
            if type(t) == "number" then
                return true, t
            end
        end)
        if ____try and ____hasReturned then
            return ____returnValue
        end
    end
    return 0
end
local function countMainInventory(self, hero)
    local c = 0
    do
        local i = 0
        while i <= 5 do
            local it = hero:GetItemInSlot(i)
            if it then
                c = c + 1
            end
            i = i + 1
        end
    end
    return c
end
local function hasItemByName(self, hero, name)
    do
        local i = 0
        while i <= 5 do
            do
                local it = hero:GetItemInSlot(i)
                if not it then
                    goto __continue13
                end
                do
                    local ____try, ____hasReturned, ____returnValue = pcall(function()
                        if it:GetAbilityName() == name then
                            return true, true
                        end
                    end)
                    if ____try and ____hasReturned then
                        return ____returnValue
                    end
                end
            end
            ::__continue13::
            i = i + 1
        end
    end
    return false
end
local function getCheapestItem(self, hero)
    local best = nil
    do
        local i = 0
        while i <= 5 do
            do
                local it = hero:GetItemInSlot(i)
                if not it then
                    goto __continue19
                end
                local name = it:GetAbilityName()
                if not name then
                    goto __continue19
                end
                if name == "item_tpscroll" then
                    goto __continue19
                end
                if __TS__StringStartsWith(name, "item_recipe_") then
                    goto __continue19
                end
                local cost = 0
                do
                    local function ____catch(e)
                        cost = 0
                    end
                    local ____try, ____hasReturned = pcall(function()
                        cost = GetItemCost(nil, name)
                    end)
                    if not ____try then
                        ____catch(____hasReturned)
                    end
                end
                if not best or cost < best.cost then
                    best = {item = it, cost = cost}
                end
            end
            ::__continue19::
            i = i + 1
        end
    end
    return best
end
local function tryPurchase(self, hero, itemName)
    ExecuteOrderFromTable({
        UnitIndex = hero:entindex(),
        OrderType = DOTA_UNIT_ORDER_PURCHASE_ITEM,
        ShopItemName = itemName
    })
end
local function trySell(self, hero, item)
    ExecuteOrderFromTable({
        UnitIndex = hero:entindex(),
        OrderType = DOTA_UNIT_ORDER_SELL_ITEM,
        TargetIndex = item:entindex()
    })
end
local function botShopThink(self, hero)
    if not isInNeutral(nil, hero) then
        return
    end
    local gold = hero:GetGold()
    local invCount = countMainInventory(nil, hero)
    if invCount >= 6 and gold >= 4500 then
        local cheapest = getCheapestItem(nil, hero)
        if cheapest and cheapest.cost <= 1000 then
            trySell(nil, hero, cheapest.item)
            return
        end
    end
    if invCount < 6 then
        local pool = gold >= 6500 and LATE_ITEMS or (gold >= 2500 and MID_ITEMS or CHEAP_ITEMS)
        do
            local k = 0
            while k < 6 do
                do
                    local name = pool[RandomInt(0, #pool - 1) + 1]
                    if not name then
                        goto __continue35
                    end
                    if hasItemByName(nil, hero, name) then
                        goto __continue35
                    end
                    local cost = 0
                    do
                        local function ____catch(e)
                            cost = 0
                        end
                        local ____try, ____hasReturned = pcall(function()
                            cost = GetItemCost(nil, name)
                        end)
                        if not ____try then
                            ____catch(____hasReturned)
                        end
                    end
                    if cost <= 0 or cost > gold then
                        goto __continue35
                    end
                    tryPurchase(nil, hero, name)
                    return
                end
                ::__continue35::
                k = k + 1
            end
        end
    end
end
local function findRandomUnitNear(self, hero, radius)
    local team = hero:GetTeamNumber()
    local o = hero:GetAbsOrigin()
    local origin = Vector(o.x, o.y, o.z)
    local units = FindUnitsInRadius(
        team,
        origin,
        nil,
        radius,
        DOTA_UNIT_TARGET_TEAM_BOTH,
        DOTA_UNIT_TARGET_HERO + DOTA_UNIT_TARGET_BASIC,
        DOTA_UNIT_TARGET_FLAG_NONE,
        FIND_ANY_ORDER,
        false
    )
    if not units or #units <= 0 then
        return nil
    end
    return units[RandomInt(0, #units - 1) + 1]
end
local function tryUseActiveItems(self, hero)
    local target = findRandomUnitNear(nil, hero, 900)
    do
        local i = 0
        while i <= 5 do
            do
                local it = hero:GetItemInSlot(i)
                if not it then
                    goto __continue45
                end
                if it:IsCooldownReady() ~= true then
                    goto __continue45
                end
                if it:IsFullyCastable() ~= true then
                    goto __continue45
                end
                local behavior = it:GetBehavior() or 0
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_TOGGLE) ~= 0 then
                    goto __continue45
                end
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_NO_TARGET) ~= 0 then
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_NO_TARGET,
                        AbilityIndex = it:entindex()
                    })
                    return true
                end
                if target and bit.band(behavior, DOTA_ABILITY_BEHAVIOR_UNIT_TARGET) ~= 0 then
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_TARGET,
                        TargetIndex = target:entindex(),
                        AbilityIndex = it:entindex()
                    })
                    return true
                end
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_POINT) ~= 0 then
                    local to = (target or hero):GetAbsOrigin()
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_POSITION,
                        Position = Vector(
                            to.x + RandomInt(-120, 120),
                            to.y + RandomInt(-120, 120),
                            to.z
                        ),
                        AbilityIndex = it:entindex()
                    })
                    return true
                end
            end
            ::__continue45::
            i = i + 1
        end
    end
    return false
end
local function tryFunCastAbilities(self, hero)
    if not isInNeutral(nil, hero) then
        return false
    end
    if RandomInt(1, 100) > 35 then
        return false
    end
    local target = findRandomUnitNear(nil, hero, 900) or hero
    do
        local i = 0
        while i < hero:GetAbilityCount() do
            do
                local ab = hero:GetAbilityByIndex(i)
                if not ab then
                    goto __continue57
                end
                if ab:GetLevel() <= 0 then
                    goto __continue57
                end
                if ab:IsCooldownReady() ~= true then
                    goto __continue57
                end
                if ab:IsFullyCastable() ~= true then
                    goto __continue57
                end
                if ab.IsPassive and ab:IsPassive() then
                    goto __continue57
                end
                local behavior = ab:GetBehavior()
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_TOGGLE) ~= 0 then
                    goto __continue57
                end
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_NO_TARGET) ~= 0 then
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_NO_TARGET,
                        AbilityIndex = ab:entindex()
                    })
                    return true
                end
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_UNIT_TARGET) ~= 0 then
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_TARGET,
                        TargetIndex = target:entindex(),
                        AbilityIndex = ab:entindex()
                    })
                    return true
                end
                if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_POINT) ~= 0 then
                    local to = target:GetAbsOrigin()
                    ExecuteOrderFromTable({
                        UnitIndex = hero:entindex(),
                        OrderType = DOTA_UNIT_ORDER_CAST_POSITION,
                        Position = Vector(
                            to.x + RandomInt(-200, 200),
                            to.y + RandomInt(-200, 200),
                            to.z
                        ),
                        AbilityIndex = ab:entindex()
                    })
                    return true
                end
            end
            ::__continue57::
            i = i + 1
        end
    end
    return false
end
local function BotThink(self)
    if not thisEntity or not IsValidEntity(thisEntity) then
        return 0.5
    end
    if not thisEntity:IsAlive() then
        return 0.5
    end
    local addon = GameRules.Addon
    local roundActive = (addon and addon.isRoundActive) == true
    local t = now(nil)
    if not roundActive or isInNeutral(nil, thisEntity) then
        if t >= nextShopThinkAt then
            nextShopThinkAt = t + 2
            botShopThink(nil, thisEntity)
        end
        if t >= nextUseItemAt then
            nextUseItemAt = t + 0.9
            if tryUseActiveItems(nil, thisEntity) then
                return 0.25
            end
        end
        if t >= nextFunCastAt then
            nextFunCastAt = t + 0.75
            if tryFunCastAbilities(nil, thisEntity) then
                return 0.25
            end
        end
        return 0.35
    end
    local team = thisEntity:GetTeamNumber()
    local enemies = FindUnitsInRadius(
        team,
        (function()
            local o = thisEntity:GetAbsOrigin()
            return Vector(o.x, o.y, o.z)
        end)(nil),
        nil,
        GAME_CONSTANTS.BOT_SEARCH_RADIUS,
        DOTA_UNIT_TARGET_TEAM_ENEMY,
        DOTA_UNIT_TARGET_BASIC,
        DOTA_UNIT_TARGET_FLAG_NONE,
        FIND_CLOSEST,
        false
    )
    if #enemies > 0 then
        local target = enemies[1]
        do
            local i = 0
            while i < thisEntity:GetAbilityCount() do
                do
                    local ab = thisEntity:GetAbilityByIndex(i)
                    if not ab then
                        goto __continue79
                    end
                    if ab:GetLevel() <= 0 then
                        goto __continue79
                    end
                    if ab:IsCooldownReady() ~= true then
                        goto __continue79
                    end
                    if ab:IsFullyCastable() ~= true then
                        goto __continue79
                    end
                    if ab.IsPassive and ab:IsPassive() then
                        goto __continue79
                    end
                    local behavior = ab:GetBehavior()
                    if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_TOGGLE) ~= 0 then
                        goto __continue79
                    end
                    if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_NO_TARGET) ~= 0 then
                        ExecuteOrderFromTable({
                            UnitIndex = thisEntity:entindex(),
                            OrderType = DOTA_UNIT_ORDER_CAST_NO_TARGET,
                            AbilityIndex = ab:entindex()
                        })
                        return 0.35
                    end
                    if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_UNIT_TARGET) ~= 0 then
                        ExecuteOrderFromTable({
                            UnitIndex = thisEntity:entindex(),
                            OrderType = DOTA_UNIT_ORDER_CAST_TARGET,
                            TargetIndex = target:entindex(),
                            AbilityIndex = ab:entindex()
                        })
                        return 0.35
                    end
                    if bit.band(behavior, DOTA_ABILITY_BEHAVIOR_POINT) ~= 0 then
                        local to = target:GetAbsOrigin()
                        ExecuteOrderFromTable({
                            UnitIndex = thisEntity:entindex(),
                            OrderType = DOTA_UNIT_ORDER_CAST_POSITION,
                            Position = Vector(to.x, to.y, to.z),
                            AbilityIndex = ab:entindex()
                        })
                        return 0.35
                    end
                end
                ::__continue79::
                i = i + 1
            end
        end
        if RandomInt(1, 100) <= 25 then
            if tryUseActiveItems(nil, thisEntity) then
                return 0.25
            end
        end
        ExecuteOrderFromTable({
            UnitIndex = thisEntity:entindex(),
            OrderType = DOTA_UNIT_ORDER_ATTACK_TARGET,
            TargetIndex = target:entindex()
        })
        return 0.25
    end
    return 0.5
end
if thisEntity and IsValidEntity(thisEntity) then
    thisEntity:SetContextThink("ArcpitBotThink", BotThink, 0.5)
end
return ____exports
